version: '3'

services:
  maven:
    image: "maven:slim"
    ports:
     - "8080:8080"
    volumes:
     - ./src:/app/src
     - ./pom.xml:/app/pom.xml
     - ./checkstyle.xml:/app/checkstyle.xml
     - ./settings.xml:/root/.m2/settings.xml
     - maven_cache:/root/.m2/repository
    working_dir: /app

  web:
    image: "maven:slim"
    ports:
     - "8080:8080"
    volumes:
     - ./src:/app/src
     - ./pom.xml:/app/pom.xml
     - ./checkstyle.xml:/app/checkstyle.xml
     - ./settings.xml:/root/.m2/settings.xml
     - maven_cache:/root/.m2/repository
    working_dir: /app
    command: mvn spring-boot:run
    depends_on:
     - "db"

  db:
    image: "postgres:alpine"
    ports:
     - "5432:5432"
    environment:
      - POSTGRES_DB=testdb
      - POSTGRES_PASSWORD=pass
      - POSTGRES_USER=dbuser

volumes:
  maven_cache:
